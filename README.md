# MoviePilot 订阅插件

> 本项目是基于 AstrBot 框架开发的 MoviePilot 订阅管理插件。
> 
> AstrBot 部署请参考：https://github.com/Soulter/AstrBot

## 功能特性

- 🔍 **影片搜索订阅** - 支持电影和电视剧搜索订阅
- 📺 **季度选择** - 电视剧自动列出可选季度
- 📥 **下载进度查看** - 可视化进度条展示下载状态
- 🔄 **自动重试机制** - 网络波动时自动重试 API 请求
- 🔐 **Token 缓存** - 智能缓存登录令牌，减少重复认证
- 🔒 **并发安全** - 支持多用户同时使用
- ⚙️ **灵活配置** - 支持自定义超时和重试参数

## 配置说明

在 AstrBot 管理面板中配置以下参数：

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `mp_url` | MoviePilot 访问地址（需公网可访问） | - |
| `mp_username` | MoviePilot 用户名 | - |
| `mp_password` | MoviePilot 密码 | - |
| `mp_timeout` | API 请求超时时间（秒） | 120 |
| `mp_max_retries` | 请求失败时的最大重试次数 | 3 |
| `mp_retry_delay` | 重试间隔时间（秒） | 1 |

## 使用指令

| 指令 | 说明 | 示例 |
|------|------|------|
| `/sub <片名>` | 搜索并订阅影片 | `/sub 星际穿越` |
| `/download` | 查看当前下载进度 | `/download` |
| `/mp_help` | 显示帮助信息 | `/mp_help` |

### 订阅流程

1. 发送 `/sub 片名` 搜索影片
2. 回复影片序号选择要订阅的影片
3. 如果是电视剧，选择要订阅的季度
4. 完成订阅

### 下载进度显示

下载进度会显示：
- 📥 当前任务数量
- ⬇️ 下载状态图标
- 可视化进度条 `[████████░░] 80.0%`
- 下载速度（如有）

## 更新日志

### v1.2.0
- ✨ 新增 `/mp_help` 帮助命令
- ✨ 新增 Token 缓存机制，减少重复登录
- ✨ 新增请求重试机制，提高稳定性
- 🎨 优化下载进度显示，添加进度条
- 🔒 添加并发锁保护，支持多用户同时使用
- 🔧 新增可配置超时和重试参数
- ♻️ 重构代码结构，提升可维护性

### v1.1.1
- 🐛 修复已知问题

### v1.0.0
- 🎉 初始版本发布

## 问题反馈

如有问题或建议，请提交到 [GitHub Issues](https://github.com/4Nest/astrbot_plugin_mp_sub/issues)
